---
# Install basic applications that I need to use Windows

- name: Install Chrome
  win_chocolatey:
    name: googlechrome
    state: present

- name: Install Firefox
  win_chocolatey:
    name: firefox
    state: present
    install_args: /NoDesktopShortcut /RemoveDistributionDir

### Set Firefox as default browser using SetDefaultBrowser.exe
- name: Install SetDefaultBrowser
  win_chocolatey:
    name: setdefaultbrowser
    state: present

- name: Set Firefox as default browser
  ansible.windows.win_powershell:
    script: |
     SetDefaultBrowser.exe HKLM Firefox-308046B0AF4A39CB

- name: Uninstall SetDefaultBrowser
  win_chocolatey:
    name: setdefaultbrowser
    state: absent
###

- name: Install 7-zip
  win_chocolatey:
    name: 7zip
    state: present

- name: Install VSCode
  win_chocolatey:
    name: vscode
    state: present

- name: Install mpv
  win_chocolatey:
    name: mpv
    state: present

# TODO: Set mpv as default player
# "$env:ProgramData\chocolatey\lib\mpv.install\tools\mpv-install.bat"

- name: Junction PowerToys settings
  ansible.windows.win_powershell:
    script: |
      New-Item -ItemType Junction -Path "$env:LocalAppData\Microsoft\PowerToys" -Target "{{ dotfiles_repo }}\win\config\PowerToys"

- name: Install PowerToys
  win_chocolatey:
    name: powertoys
    state: present

- name: Hardlink WindowsTerminal settings
  ansible.windows.win_powershell:
    script: |
      $settings = "$env:LocalAppData\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json"
      if (Test-Path $settings) {
          Remove-Item $settings
      }
      New-Item -ItemType HardLink -Path "$settings" -Target "{{ dotfiles_repo }}\win\config\WindowsTerminal\settings.json"

- name: Install PowerShell Core
  win_chocolatey:
    name: powershell-core
    state: present

- name: Configure PowerShell Core
  ansible.windows.win_powershell:
    script: |
      Install-Module -Scope CurrentUser -Name posh-git
      Install-Module -Scope CurrentUser -Name DockerCompletion
      Install-Module -Scope CurrentUser -Name ChangeScreenResolution
      New-Item -ItemType Junction -Path "$env:UserProfile\Documents\PowerShell" -Target "{{ dotfiles_repo }}\win\config\PowerShell"

# TODO: Copy .gitconfig
