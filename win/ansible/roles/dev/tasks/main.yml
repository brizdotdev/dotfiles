---
# Install dev applications

- name: Install WinMerge
  win_chocolatey:
    name: winmerge
    state: present

- name: Install WinSCP
  win_chocolatey:
    name: winscp
    state: present

- name: Install gsudo
  win_chocolatey:
    name: gsudo
    state: present

- name: Install Neovim
  win_chocolatey:
    name: neovim
    state: present

# TODO: Configure Neovim

- name: Install Alacritty
  win_chocolatey:
    name: alacritty
    state: present

# TODO: Test
- name: Remove linux import from Alacritty
  community.windows.win_lineinfile:
    regex: 'linux\.yml'
    backrefs: yes
    state: absent

# TODO: Test
- name: Junction Alacritty settings
  ansible.windows.win_powershell:
    script: |
      $source = "$env:AppData\alacritty"
      $target  = "{{ dotfiles_repo_fullpath }}\common\config\alacritty"
      $type = "Junction"
      $existing = Get-Item -Path $source -ErrorAction SilentlyContinue
      if ($?) {
        if ($existing.LinkType -eq $type)
        {
          $Ansible.Changed = $false
          exit
        }
        Remove-Item -Path $source
      }
      New-Item -ItemType Junction -Path "$source" -Target "$target"


- name: Install Insomnia
  win_chocolatey:
    name: insomnia-rest-api-client
    state: present

- name: Install Python3
  win_chocolatey:
    name: python3
    state: present

- name: Install NodeJS
  win_chocolatey:
    name: nodejs.install
    state: present

- name: Install ripgrep
  win_chocolatey:
    name: ripgrep
    state: present

- name: Install fzf
  win_chocolatey:
    name: fzf
    state: present

- name: Install zoxide
  win_chocolatey:
    name: zoxide
    state: present

- name: Install jq
  win_chocolatey:
    name: jq
    state: present

- name: Install lazygit
  win_chocolatey:
    name: lazygit
    state: present

- name: Configure lazygit
  ansible.windows.win_powershell:
    script: |
      $source = "$env:AppData\lazygit\config.yml"
      $target = "{{ dotfiles_repo_fullpath }}\common\config\lazygit\config.yml"
      $type = "HardLink"
      $existing = Get-Item -Path $source -ErrorAction SilentlyContinue
      if ($?) {
        if ($existing.LinkType -eq $type)
        {
          $Ansible.Changed = $false
          exit
        }
        Remove-Item -Path $source
      }
      mkdir.exe -p $env:AppData\lazygit
      New-Item -ItemType $type -Path "$source" -Target "$target"

- name: Install fd
  win_chocolatey:
    name: fd
    state: present

# TODO: Configure above apps
# TODO: Generate an SSH Key
# TODO: Setup WSL
# TODO: Setup Tmux
# TODO: Setup docker